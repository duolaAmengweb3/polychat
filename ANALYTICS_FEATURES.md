# 数据分析功能文档

## 概述

基于 Polymarket 的 7 天历史价格数据，本项目新增了全面的市场分析功能，包括统计指标、趋势分析、波动性分析和多选项对比等。

---

## 🎯 新增功能列表

### 1. **市场洞察面板**（首页）

首页新增了「市场洞察」模块，提供三种视角快速发现有价值的市场：

#### 📈 趋势最强
- 展示价格方向性变化最明显的市场
- 基于线性回归计算趋势强度
- 适合寻找有明确方向的市场

#### ⚡ 波动最大
- 展示价格波动最剧烈的市场
- 可能存在争议或有新信息出现
- 适合短期交易机会

#### 💰 交易量最大
- 展示 24 小时交易量最高的市场
- 市场参与度最高，流动性最好
- 适合大额交易

**特色**：
- 每个市场卡片显示趋势标签（强劲上涨/温和上涨/横盘震荡/温和下跌/强劲下跌）
- 实时显示当前概率和 7 天变化
- 根据不同 tab 显示对应的关键指标

---

### 2. **市场统计指标面板**（详情页）

展示单个市场的全面统计数据，包括：

#### 核心指标（大卡片）
- **当前概率**：最新的市场概率
- **7天变化**：绝对变化（百分点）和相对变化（%）
- **趋势**：带图标和颜色的趋势指示（🚀📈➡️📉⚠️）
- **波动率**：低/中/高/极端四个等级

#### 详细指标（小卡片）
- **平均概率**：7 天期间的平均值
- **7天最高/最低**：价格区间边界
- **价格区间**：最高最低差值
- **近期动量**：最近与早期数据的对比
- **急剧变化次数**：超过正常波动 2 倍的跳动统计

#### 数据质量指示
- 显示数据点数量
- 评估数据完整性（完整/尚可/稀疏）

---

### 3. **趋势分析面板**（详情页）

深度分析市场趋势，提供：

#### 主趋势指示器
- 渐变色背景卡片，直观显示趋势方向
- 趋势强度百分比
- 详细的趋势描述

#### 趋势强度可视化
- 进度条展示趋势强度
- 颜色与趋势方向匹配

#### 辅助指标
- **近期动量**：向上/向下/平稳
- **价格跳动**：频繁/中等/稳定

#### 趋势解读说明
- 解释各项指标的计算方法
- 帮助用户理解数据含义

---

### 4. **多选项对比功能**（详情页）

对于有多个 outcome 的市场（如 Yes/No 或多选题），可以：

#### 对比图表
- 在同一张图中显示所有选项的价格走势
- 每个选项使用不同颜色区分
- 支持最多 6 种颜色方案

#### 当前值对比卡片
- 并排显示所有选项的当前概率
- 显示每个选项的 7 天涨跌幅
- 颜色边框与图表中的线条颜色一致

#### 套利提示
- 对于 Yes/No 市场，提示两选项概率之和应接近 100%
- 如果偏离较多，可能存在套利机会

**使用方式**：
- 点击「对比所有选项」按钮切换到对比模式
- 点击「单独查看」返回单选项详细分析

---

## 📊 分析算法说明

### 波动率计算
```
使用标准差（Standard Deviation）衡量价格离散程度
- 低波动：σ < 5%
- 中等波动：5% ≤ σ < 10%
- 高波动：10% ≤ σ < 20%
- 极端波动：σ ≥ 20%
```

### 趋势检测
```
使用线性回归（Linear Regression）拟合价格曲线
斜率 > 0.015：强劲上涨
斜率 > 0.005：温和上涨
-0.005 ≤ 斜率 ≤ 0.005：横盘震荡
斜率 < -0.005：温和下跌
斜率 < -0.015：强劲下跌
```

### 动量指标
```
比较最近 1/4 数据与早期 1/4 数据的平均价格差
正值：向上动量
负值：向下动量
```

### 急剧变化检测
```
统计价格变化超过平均变化 2 倍的次数
反映市场情绪的不稳定性
```

---

## 🎨 UI/UX 特色

### 视觉设计
- **渐变色卡片**：不同趋势使用不同颜色渐变
  - 强劲上涨：绿色到翠绿
  - 温和上涨：浅绿到绿色
  - 横盘震荡：灰色系
  - 温和下跌：橙色到红色
  - 强劲下跌：深红色系

- **图标语言**：每种状态配有对应 emoji
  - 🚀 强劲上涨
  - 📈 温和上涨
  - ➡️ 横盘震荡
  - 📉 温和下跌
  - ⚠️ 强劲下跌

### 响应式布局
- 支持多种屏幕尺寸
- 首页洞察面板：1/2/3 列自适应
- 详情页指标：2/3/4 列自适应

### 暗黑模式支持
- 所有新组件完全支持暗黑模式
- 自动适配系统主题

---

## 📁 文件结构

```
polychart-mvp/
├── lib/
│   └── analytics.ts          # 数据分析核心算法库
├── components/
│   ├── MarketStats.tsx        # 市场统计指标组件
│   ├── TrendIndicator.tsx     # 趋势分析组件
│   ├── ComparisonChart.tsx    # 多选项对比图表
│   └── MarketInsights.tsx     # 首页市场洞察面板
├── app/
│   ├── page.tsx               # 首页（已集成 MarketInsights）
│   └── market/[id]/page.tsx   # 详情页（已集成所有分析组件）
```

---

## 🚀 使用指南

### 浏览市场洞察
1. 访问首页 http://localhost:3001
2. 查看「市场洞察」模块
3. 切换「趋势最强」「波动最大」「交易量最大」标签
4. 点击感兴趣的市场卡片进入详情

### 查看详细分析
1. 进入任意市场详情页
2. 选择要分析的 outcome
3. 向下滚动查看：
   - 价格走势图
   - 市场统计指标
   - 趋势分析面板

### 对比多个选项
1. 在有多个 outcome 的市场详情页
2. 点击「对比所有选项」按钮
3. 查看所有选项在同一图表中的对比
4. 观察各选项的相对表现

---

## 💡 实用建议

### 识别交易机会
- **强趋势 + 低波动**：趋势明确且稳定，适合趋势跟随
- **高波动 + 急剧变化多**：市场存在争议，可能有新信息，适合短线
- **多选项概率和异常**：Yes/No 市场概率和偏离 100% 可能有套利机会

### 风险评估
- **数据质量「稀疏」**：数据不足，分析结果可信度较低
- **极端波动 + 低交易量**：可能是数据异常或极冷门市场
- **趋势强度很高**：可能接近顶部或底部，注意反转风险

### 市场筛选
- 使用首页洞察快速找到符合策略的市场
- 「趋势最强」适合中长线
- 「波动最大」适合日内交易
- 「交易量最大」适合大额交易

---

## 🔮 未来扩展方向

虽然当前版本已实现核心分析功能，以下是可能的扩展方向：

1. **市场相关性分析**：找出相关联的市场
2. **价格预测模型**：基于历史数据的简单预测
3. **异常检测**：识别价格异常波动点
4. **用户提醒系统**：价格达到阈值时通知
5. **数据导出功能**：导出分析报告为 PDF/CSV
6. **自定义分析指标**：允许用户配置分析参数

---

## ⚠️ 注意事项

1. **所有分析基于 7 天历史数据**，时间跨度有限
2. **数据来自 Polymarket API**，受 API 限制和网络延迟影响
3. **分析结果仅供参考**，不构成投资建议
4. **市场流动性**：冷门市场数据可能不完整，影响分析准确性
5. **计算密集**：首页分析 10 个市场可能需要几秒钟加载时间

---

## 🎓 技术亮点

- **无需数据库**：完全基于 API 实时数据计算
- **客户端分析**：所有计算在浏览器完成，服务器压力小
- **模块化设计**：分析逻辑独立封装，易于维护和扩展
- **类型安全**：完整的 TypeScript 类型定义
- **性能优化**：并发请求多个市场数据，使用 SWR 缓存

---

## 📞 反馈与支持

如有问题或建议，欢迎通过以下方式联系：
- GitHub Issues
- 项目讨论区

---

**祝您交易愉快！** 🎉
